<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <script type="application/ld+json">

{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Implementing a Unix Shell",
  
  "datePublished": "2022-04-18T17:35:13-04:00",
  "dateModified": "2022-04-18T17:35:13-04:00",
  "author": {
    "@type": "Person",
    "name": "Shreyas Mayya",
    
    "image": "https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51"
    
  },
  "mainEntityOfPage": { 
    "@type": "WebPage",
    "@id": "https:\/\/www.smayya.me\/2022\/04\/implementing-a-unix-shell\/" 
  },
  "publisher": {
    "@type": "Organization",
    "name": "Shreyas Mayya",
    
    "logo": {
      "@type": "ImageObject",
      "url": "https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51"
    }
    
  },
  "description": "My senior research project was implementing a Unix shell in the Rust language. Here\u0026rsquo;s a few things I discovered along the way.\n",
  "keywords": ["rust, shell, unix"]
}

</script>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Hugo 0.80.0 with theme Tranquilpeak 0.5.3-BETA">
<meta name="author" content="Shreyas Mayya">
<meta name="keywords" content="rust, shell, unix">
<meta name="description" content="My senior research project was implementing a Unix shell in the Rust language. Here&rsquo;s a few things I discovered along the way.">


<meta property="og:description" content="My senior research project was implementing a Unix shell in the Rust language. Here&rsquo;s a few things I discovered along the way.">
<meta property="og:type" content="article">
<meta property="og:title" content="Implementing a Unix Shell">
<meta name="twitter:title" content="Implementing a Unix Shell">
<meta property="og:url" content="https://www.smayya.me/2022/04/implementing-a-unix-shell/">
<meta property="twitter:url" content="https://www.smayya.me/2022/04/implementing-a-unix-shell/">
<meta property="og:site_name" content="Shreyas Mayya">
<meta property="og:description" content="My senior research project was implementing a Unix shell in the Rust language. Here&rsquo;s a few things I discovered along the way.">
<meta name="twitter:description" content="My senior research project was implementing a Unix shell in the Rust language. Here&rsquo;s a few things I discovered along the way.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2022-04-18T17:35:13">
  
  
    <meta property="article:modified_time" content="2022-04-18T17:35:13">
  
  
  
    
      <meta property="article:section" content="School">
    
      <meta property="article:section" content="Tech">
    
  
  
    
      <meta property="article:tag" content="Code">
    
      <meta property="article:tag" content="Linux">
    
      <meta property="article:tag" content="Projects">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51?s=640">
  <meta property="twitter:image" content="https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51?s=640">






    <title>Implementing a Unix Shell</title>

    <link rel="icon" href="https://www.smayya.me/images/favicon.png">
    

    

    <link rel="canonical" href="https://www.smayya.me/2022/04/implementing-a-unix-shell/">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    
    
    <link rel="stylesheet" href="https://www.smayya.me/css/style-h6ccsoet3mzkbb0wngshlfbaweimexgqcxj0h5hu4h82olsdzz6wmqdkajm.min.css" />
    
    
      
        <link rel="stylesheet"  href="https://www.smayya.me/css/fonts.css">
      
    
      
        <link rel="stylesheet"  href="https://www.smayya.me/css/custom.css">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-178511926-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://www.smayya.me/" aria-label="Go to homepage">Shreyas Mayya</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://www.smayya.me/#about" aria-label="Open the link: /#about">
    
    
    
      
        <img class="header-picture" src="https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://www.smayya.me/#about" aria-label="Read more about the author">
          <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Shreyas Mayya</h4>
        
          <h5 class="sidebar-profile-bio"><p>Hello! I&rsquo;m Shreyas. I&rsquo;m currently a senior at Thomas Jefferson High School for Science and Technology in Alexandria, VA. This blog is where I like to write about random thoughts and experiences from my life.</p>
<p><a href="https://www.smayya.me/about">Learn more about me!</a></p>
</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.smayya.me/" title="Home">
    
      <i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.smayya.me/#about" title="About">
    
      <i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.smayya.me/categories" title="Categories">
    
      <i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.smayya.me/tags" title="Tags">
    
      <i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.smayya.me/archives" title="Archives">
    
      <i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://facebook.com/smayya337" target="_blank" rel="noopener" title="Facebook">
    
      <i class="sidebar-button-icon fab fa-lg fa-facebook"></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/smayya337" target="_blank" rel="noopener" title="GitHub">
    
      <i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden="true"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://instagram.com/smayya337" target="_blank" rel="noopener" title="Instagram">
    
      <i class="sidebar-button-icon fab fa-lg fa-instagram"></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" id="top">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title">
      Implementing a Unix Shell
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time datetime="2022-04-18T17:35:13-04:00">
        
  April 18, 2022

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://www.smayya.me/categories/school">School</a>, 
    
      <a class="category-link" href="https://www.smayya.me/categories/tech">Tech</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown">
            <div class="main-content-wrap">
              <p>My senior research project was <a href="https://github.com/smayya337/senior-research">implementing a Unix shell</a> in the Rust language. Here&rsquo;s a few things I discovered along the way.</p>
<div class="alert info ">
  <p>This page is not complete! I will continue to update it with more information throughout April and May as I continue writing my final paper on this project.</p>
</div>
<h2 id="goals">Goals</h2>
<h2 id="implementation">Implementation</h2>
<h3 id="execution">Execution</h3>
<p>This was actually pretty straightforward. When you&rsquo;re writing a shell in C, normally what you do is use the <code>fork()</code> system call, which creates a child process and returns its process ID (PID). In Rust, we don&rsquo;t have to bother with as much lower-level stuff because of a struct called <a href="https://doc.rust-lang.org/std/process/struct.Command.html"><code>std::process::Command</code></a>, which provides some easy methods for us to just load up whatever command we want and run it.</p>

  
    
  
  
    
  
  
  


<figure class="highlight rust language-rust">
  <figcaption>
    
      <span>Executing commands</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-rust rust"><code class="rust">pub fn exec(command: &amp;str, args: Vec&lt;&amp;str&gt;) -&gt; i32 {
    let canon = canonical_path(&amp;command);
    let path = Path::new(&amp;canon);
    if path.is_file() {
        return if path.is_executable() {
            read_from_script(command, args)
        } else {
            println!(&#34;{}: permission denied: {}&#34;, env!(&#34;CARGO_PKG_NAME&#34;), command);
            126
        };
    }
    return match command {
        &#34;cd&#34; =&gt; {
            let dest = args.first();
            cd(dest)
        }
        &#34;info&#34; =&gt; info(),
        &#34;exit&#34; =&gt; exit(0),
        &#34;history&#34; =&gt; display_history(),
        _ =&gt; {
            let child = Command::new(command).args(args).spawn();
            match child {
                Ok(x) =&gt; {
                    let mut y = x;
                    y.wait().unwrap().code().unwrap()
                }
                Err(_) =&gt; 127,
            }
        }
    };
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<h3 id="changing-directories">Changing Directories</h3>
<p>One of the most vital commands in any shell is <code>cd</code>, which stands for &ldquo;change directory&rdquo;. <code>cd</code> is a <em>builtin</em>, meaning that its functionality is literally written into the code of the shell (unlike the vast majority of programs, which are separate executables).</p>
<p>It just so happens that there&rsquo;s a function for that, too! <a href="https://doc.rust-lang.org/stable/std/env/fn.set_current_dir.html"><code>std::env::set_current_dir</code></a> actually changes our directory. We just need to figure out which directory to go to, which is easier said than done because of shortcuts like <code>..</code> (parent directory) and <code>~</code> (home directory). For example, assuming my home directory is <code>/home/shreyas</code>, <code>~/Music/../Code/senior-research/src/main.rs</code> is the same thing as <code>/home/shreyas/Code/senior-research/src/main.rs</code>, but a program won&rsquo;t necessarily view them as the same. The following code helps canonicalize paths so that you get taken to the right place.</p>

  
    
  
  
    
  
  
  


<figure class="highlight rust language-rust">
  <figcaption>
    
      <span>Determining which directory to travel to</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-rust rust"><code class="rust">pub fn canonical_path(x: &amp;&amp;str) -&gt; String {
    let homedir = home::home_dir().unwrap().display().to_string();
    let mut canon = String::from(*x);
    if x.starts_with(&amp;&#34;~&#34;) {
        canon = canon.replace(&#34;~&#34;, &amp;homedir);
    } else if x.contains(&amp;&#34;..&#34;) {
        let mut spl = x.split(&#34;..&#34;).peekable();
        let mut np = Vec::new();
        while let Some(y) = spl.next() {
            let p = match spl.peek() {
                Some(_) =&gt; dotdot(PathBuf::from(y)),
                None =&gt; String::from(y),
            };
            np.push(p);
        }
        canon = np.join(&#34;/&#34;);
    }
    canon
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<div class="alert info ">
  <p>I discovered some time after this that <a href="https://doc.rust-lang.org/stable/std/fs/fn.canonicalize.html"><code>std::fs::canonicalize</code></a> exists and does basically what I want, but I haven&rsquo;t gotten around to replacing <code>canonical_path</code> with it yet.</p>
</div>
<h3 id="history">History</h3>
<div class="alert warning ">
  <p>The shell currently tries to open <code>~/.shell_history</code> on startup, and if it doesn&rsquo;t find the file, it panics and exits. I need to fix that error handling. For now, just run <code>touch ~/.shell_history</code> and try again.</p>
</div>
<h3 id="interface">Interface</h3>
<p>The interface of the shell relied heavily on the <a href="https://github.com/redox-os/termion"><code>termion</code></a> library to interface with the terminal.</p>
<h4 id="the-input-bug">The Input Bug</h4>
<p>Here&rsquo;s how it looks now:</p>

  
    
  
  
    
  
  
  


<figure class="highlight rust language-rust">
  <figcaption>
    
      <span>What I had to do instead</span>
    
  </figcaption>
  <table>
    <tbody>
      <tr>
        <td class="gutter">
          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre>
        </td>
        <td class="code">
          <pre class="code-highlight language-rust rust"><code class="rust">fn main() {
    let mut history = read_history();
    let mut history_pos = history.len();
    let mut beginning_of_line = prompt().len() as u16;
    let mut horiz_pos = beginning_of_line &#43; 1;
    // Set terminal to raw mode to allow reading stdin one key at a time
    let mut stdout = MouseTerminal::from(io::stdout()).into_raw_mode().unwrap();
    write!(stdout, &#34;{}&#34;, prompt()).unwrap();
    stdout.lock().flush().unwrap();

    // Use asynchronous stdin
    let mut stdin = termion::async_stdin().keys();

    // Our string
    let mut input = String::new();
    let mut length_of_line = beginning_of_line as u16;

    loop {
        // Read input (if any)
        let next = stdin.next();

        // If a key was pressed
        if let Some(Ok(key)) = next {
            match key {
                // Exit if &#39;Ctrl&#43;c&#39; is pressed
                termion::event::Key::Ctrl(&#39;c&#39;) =&gt; {
                    input = String::new();
                    write!(stdout, &#34;\r\n&#34;).unwrap();
                    write!(stdout, &#34;{}&#34;, prompt()).unwrap();
                }
                // Quit everything if &#39;Ctrl&#43;d&#39; is pressed
                termion::event::Key::Ctrl(&#39;d&#39;) =&gt; {
                    exit(0);
                }
                // Clear screen if &#39;Ctrl-l&#39; is pressed
                termion::event::Key::Ctrl(&#39;l&#39;) =&gt; {
                    input = String::new();
                    write!(
                        stdout,
                        &#34;{}{}\r&#34;,
                        termion::clear::All,
                        termion::cursor::Goto(1, 1)
                    )
                    .unwrap();
                    write!(stdout, &#34;{}&#34;, prompt()).unwrap();
                }
                // Return command if &#39;Enter&#39; is pressed
                termion::event::Key::Char(&#39;\n&#39;) =&gt; {
                    write!(stdout, &#34;\r\n&#34;).unwrap();
                    stdout.suspend_raw_mode().unwrap();
                    let time = cmd_time();
                    let (cmd, vec) = separate(&amp;input);
                    let ecode = match cmd {
                        Some(x) =&gt; exec(x, vec),
                        None =&gt; 0,
                    };
                    if ecode == 127 {
                        eprintln!(&#34;{}: command not found...&#34;, cmd.unwrap());
                    }
                    if cmd.is_some() &amp;&amp; cmd.unwrap().ne(&#34;history&#34;) {
                        write_history(time, &amp;input);
                        history.push(input);
                        history_pos = history.len();
                    }
                    input = String::new();
                    beginning_of_line = prompt().len() as u16;
                    horiz_pos = beginning_of_line &#43; 1;
                    length_of_line = beginning_of_line as u16;
                    write!(stdout, &#34;{}&#34;, prompt()).unwrap();
                    stdout.activate_raw_mode().unwrap();
                }
                termion::event::Key::Backspace =&gt; {
                    if input.len() &gt; 0 {
                        input.pop();
                        write!(
                            stdout,
                            &#34;{}{}{}&#34;,
                            termion::cursor::Left(1),
                            &#34; &#34;,
                            termion::cursor::Left(1)
                        )
                        .unwrap();
                        length_of_line -= 1;
                        horiz_pos -= 1;
                    }
                }
                termion::event::Key::Left =&gt; {
                    if horiz_pos &gt; beginning_of_line &#43; 1 {
                        write!(stdout, &#34;{}&#34;, termion::cursor::Left(1)).unwrap();
                        horiz_pos -= 1;
                    }
                }
                termion::event::Key::Right =&gt; {
                    if horiz_pos &lt; length_of_line {
                        write!(stdout, &#34;{}&#34;, termion::cursor::Right(1)).unwrap();
                        horiz_pos &#43;= 1;
                    }
                }
                termion::event::Key::Up =&gt; {
                    write!(
                        stdout,
                        &#34;{}{}{}&#34;,
                        termion::clear::CurrentLine,
                        termion::cursor::Left(horiz_pos),
                        prompt()
                    )
                    .unwrap();
                    if history_pos &gt; 0 {
                        history_pos -= 1;
                        input = history[history_pos].clone();
                    } else {
                        input = history[0].clone();
                    }
                    length_of_line = beginning_of_line &#43; input.len() as u16;
                    horiz_pos = length_of_line;
                    write!(stdout, &#34;{}&#34;, input).unwrap();
                }
                termion::event::Key::Down =&gt; {
                    write!(
                        stdout,
                        &#34;{}{}{}&#34;,
                        termion::clear::CurrentLine,
                        termion::cursor::Left(horiz_pos),
                        prompt()
                    )
                    .unwrap();
                    if history_pos &lt; history.len() - 1 {
                        history_pos &#43;= 1;
                        input = history[history_pos].clone();
                        write!(stdout, &#34;{}&#34;, input).unwrap();
                    } else {
                        input = String::new();
                    }
                    length_of_line = beginning_of_line &#43; input.len() as u16;
                    horiz_pos = length_of_line;
                }
                termion::event::Key::Char(x) =&gt; {
                    input.push(x);
                    write!(stdout, &#34;{}&#34;, x).unwrap();
                    length_of_line &#43;= 1;
                    horiz_pos &#43;= 1;
                }
                _ =&gt; {}
            }
        }
        stdout.lock().flush().unwrap();
        thread::sleep(time::Duration::from_millis(50));
    }
}</code></pre>
        </td>
      </tr>
    </tbody>
  </table>
</figure>

<p>Yeah, it&rsquo;s <em>long</em>.</p>
<h2 id="usage">Usage</h2>
<div class="alert warning ">
  <p>The shell has issues with interactive commands. If you run <code>python</code>, most of the characters are captured by the shell instead of passing through to the Python console. Running another shell like <code>bash</code> or <code>zsh</code> causes the shell process to be suspended as soon as you start typing. I don&rsquo;t really know what causes this behavior.</p>
</div>
              


            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://www.smayya.me/tags/code/">Code</a>

  <a class="tag tag--primary tag--small" href="https://www.smayya.me/tags/linux/">Linux</a>

  <a class="tag tag--primary tag--small" href="https://www.smayya.me/tags/projects/">Projects</a>

                  </div>
                
              
            
            
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


            
  


          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2022 <a href="https://github.com/smayya337/smayya337.github.io">Shreyas Mayya</a>. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
<div class="post-actions-wrap">
  <nav >
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <i class="fa fa-angle-left"></i>
              <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
            </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--disabled">
          
              <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
              <i class="fa fa-angle-right"></i>
            </a>
        </li>
      
    </ul>
  </nav>
<ul class="post-actions post-action-share" >
  
    <li class="post-action hide-lg hide-md hide-sm">
      <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </a>
    </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Facebook" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Twitter" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i>
        </a>
      </li>
    
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https://www.smayya.me/2022/04/implementing-a-unix-shell/" title="Share on Linkedin" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i>
        </a>
      </li>
    
  
  
  <li class="post-action">
    
      <a class="post-action-btn btn btn--default" href="#top" aria-label="Back to top">
      <i class="fa fa-arrow-up" aria-hidden="true"></i>
    
    </a>
  </li>
</ul>
</div>


      </div>
      
<div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.smayya.me%2F2022%2F04%2Fimplementing-a-unix-shell%2F" aria-label="Share on Facebook">
          <i class="fab fa-facebook-square" aria-hidden="true"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fwww.smayya.me%2F2022%2F04%2Fimplementing-a-unix-shell%2F" aria-label="Share on Twitter">
          <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.smayya.me%2F2022%2F04%2Fimplementing-a-unix-shell%2F" aria-label="Share on Linkedin">
          <i class="fab fa-linkedin" aria-hidden="true"></i><span>Share on Linkedin</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>


    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://www.gravatar.com/avatar/59631d6bde13fa8876b6e3dc220e0c51?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Shreyas Mayya</h4>
    
      <div id="about-card-bio"><p>Hello! I&rsquo;m Shreyas. I&rsquo;m currently a senior at Thomas Jefferson High School for Science and Technology in Alexandria, VA. This blog is where I like to write about random thoughts and experiences from my life.</p>
<p><a href="https://www.smayya.me/about">Learn more about me!</a></p>
</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Student
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker-alt"></i>
        <br/>
        Lorton, Virginia
      </div>
    
  </div>
</div>

    

    
  
    
      <div id="cover" style="background-image:url('https://www.smayya.me/images/plasma-519-flow.jpg');"></div>
    
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js" integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script src="https://www.smayya.me/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js"></script>


  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/apache.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/dns.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/http.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/nginx.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/puppet.min.js"></script>
  

  
    <script async crossorigin="anonymous" defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/stylus.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>




    
  </body>
</html>

